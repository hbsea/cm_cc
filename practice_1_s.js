var vCodes;var vIndex=new Array();var industryCodesStore="";var relevanceDomain=new Array();var idArr=new Array();sps.loadStudyRedis=function(){var d=13;var c=base.getCookie("loginUser",c);var z=c.rankId;var A=c.politicsCode;var o=c.domainCode;var p="";if(industryCodesStore==""){industryCodesStore=sps.getIndustryCodes(o)}p=industryCodesStore;if(p.indexOf("00000000")==-1){p=p+";00000000"}var f=p.split(";");var e=/,+$/gi;var a="";var b=0;if("000"==o.substr(0,3)){b=0}else{if("000"==o.substr(3,3)){b=1}else{if("000"==o.substr(6,3)){b=2}else{if("000"==o.substr(9,3)){b=3}else{if("000"==o.substr(12,3)){b=4}else{b=5}}}}}var x="";for(var y=1;y<=b;y++){var h=15-(y*3);x=addStr(o.substr(0,y*3),h);a+="STUDY:COURSE:STR."+d+"_"+x+"_"+z+",";if(A!=null&&A!=""){a+="STUDY:COURSE:STR."+d+"_"+x+"_"+A+","}}var B="";for(var s=0;s<relevanceDomain.length;s++){var w=relevanceDomain[s].length;var u;var v;var g="";var b=sps.getIndustryGrade(relevanceDomain[s]);for(var y=4-b;y<3;y++){u=w-(y*6);v=relevanceDomain[s].substring(0,u);g=addStr(v,y*6);if(B.indexOf(g)!=-1){continue}B+=g+",";a+="STUDY:COURSE:STR."+d+"_"+g+"_"+z+",";if(A!=null&&A!=""){a+="STUDY:COURSE:STR."+d+"_"+g+"_"+A+","}}}a=a.replace(e,"");sps.getCourseData(a,p,d)};sps.getIndustryCodes=function(b){var a="";jQuery.ajax({type:"POST",url:sps.url.lesson.getIndustryCodes+"?domainCode="+b+"&time="+new Date(),async:false,success:function(c){if(c.indexOf("$-1")!=0){a=base.nrMultiLineText2Array(c)[0]}else{a="00000000"}}});return a};function addStr(c,a){for(var b=0;b<(parseInt(a));b++){c+="0"}return c}sps.getCourseData=function(c,a,b){jQuery.ajax({type:"POST",url:sps.url.lesson.getCourseByIndustryCodes+"?fileds="+c+"&industryCodes="+a+"&languageType=4&time="+new Date(),async:false,success:function(m){var e=new Array();if(m.indexOf('{"')==0){var g=m.charAt(2);var m=JSON.parse(m);for(var l in m){e.push(m[l])}}else{if(m.indexOf("[")==0){m=JSON.parse(m);for(var l in m){if(!JSON.stringify(m[l])){continue}if(JSON.stringify(m[l]).indexOf('["')>-1){for(var h=0;h<m[l].length;h++){var n=m[l][h];if(n){e.push(n)}}}else{for(var f in m[l]){if(m[l][f]){e.push(m[l][f])}}}}}}m=e;if(m.indexOf("{}")==0){m=m.replace(/(^\s*)|(\s*$)/g,"");m=m.replace("{}","")}sps.combineData(m,b)}})};sps.sortArrForPrac=function(a){return a.sort(function(c,b){return(c.courseSort==b.courseSort)?(sps.cpTime(c.createdTime,b.createdTime)?1:-1):(c.courseSort>b.courseSort?1:-1)})};sps.cpTime=function(c,h){var f=c.replace(/-/g,"/");var g=h.replace(/-/g,"/");var d=(Date.parse(g)-Date.parse(f))/3600/1000;return d>=0?true:false};sps.combineData=function(data,type){var kqYear=$("#yearSelect").val();var idTempArr=new Array();for(var i=0;i<data.length;i++){var dataObj=eval("("+data[i]+")");$.each(dataObj,function(i,n){var industryCodes=n.industryCodes;if(n.createdTime.indexOf(kqYear)==0&&industryCodes!="00000000"){idArr.push(n.courseId)}if(n.createdTime.indexOf(kqYear)==0&&idTempArr.indexOf(n.courseId)==-1){idTempArr.push(n)}})}idTempArr=sps.sortArrForPrac(idTempArr);if(idArr.length==0&&idTempArr.length!=0){idArr.push(idTempArr[0].courseId)}};sps.practiceList=function(){var c=base.getCookie("loginUser",c);var a=c.userAccount;var b=$("#yearSelect").val();jQuery.ajax({type:"post",url:sps.url.practice.monthlyList,data:{userAccount:a,courseId:idArr.toString(),practiceYears:b},dataType:"json",success:function(f){if(f.code==200){var e=f.data;if(e.length>0){var d="";$.each(e,function(n,q){var g=q.month;var o=g.substring(0,4)+"年第"+g.substring(4,g.length)+"季度";var p=q.praCount;var i=q.status;var m=q.courseId;var l=q.isCurQuarter;var h="未开始";if(i==0){h="未完成"}else{if(i==1){h="已完成本季度学法考勤"}else{if(i==4){h="进行中"}}}if(i==0){d=d+'<div class="boxList borerRed">'}else{if(i==1||i==4){d=d+'<div class="boxList borerGreen">'}else{d=d+'<div class="boxList borerGray">'}}d=d+'<input type="hidden" id="courseId" value="'+m+'" />';d=d+'<input type="hidden" id="ym" value="'+g+'" />';d=d+'<input type="hidden" id="isCurQuarter" value="'+l+'" />';d=d+'<div class="boxListtime">';d=d+"<p>"+o+"</p>";if(i==0){d=d+'<img src="/baseui/images/practice/1.png">'}else{if(i==1){d=d+'<img src="/baseui/images/practice/2.png">'}else{if(i==-1){d=d+'<img src="/baseui/images/practice/3.png">'}}}d=d+"</div>";d=d+'<div class="status">'+h+"</div>";d=d+'<div class="quantity">练习次数：'+p+"次</div>";d=d+"</div>"});$(".dateBoxD").html(d);$(".boxList").click(function(){var g=$(this).find("#courseId").val();var h=$(this).find("#isCurQuarter").val();if(h==1){sps.list(g)}else{base.popwinOpenText({title:"操作提示",msg:"请在对应的时间进行学法考勤答题",hasConfirm:true})}})}else{$(".dateBoxD").height(300);$(".dateBoxD").html('<div class="practicelist" style=""><div class="practicelistnull" >暂无考勤</div></div>')}}else{$(".dateBoxD").height(300);$(".dateBoxD").html('<div class="practicelist" style=""><div class="practicelistnull" >暂无考勤</div></div>')}},error:function(f,d,g){}})};sps.getMonthQuarter=function(b){var a=0;if(b<4){a=1}else{if(b<7){a=2}else{if(b<10){a=3}else{a=4}}}return a};sps.initYears=function(){var a=new Date();var b=a.getFullYear();$("#kqYear").text(b);jQuery.ajax({type:"post",url:sps.url.practice.getYears,data:{},dataType:"json",async:false,success:function(d){if(d.code==200){var e=d.data;var c="";$.each(e,function(f,g){if(b==g){c=c+'<option value="'+g+'" selected="selected">'+g+"年</option>"}else{c=c+'<option value="'+g+'">'+g+"年</option>"}});$("#yearSelect").html(c)}},error:function(d,c,f){}})};sps.changeYear=function(b){var a=$(b).val();$("#kqYear").text(a);sps.loadStudyRedis();sps.practiceList()};sps.list=function(a){jQuery.ajax({type:"post",url:sps.url.exercies.list+"?courseId="+a,async:false,success:function(d){var b=base.nrMultiLineText2Array(d);if(b.length>0){var f=b[0];var h=sps.getParams(f);var g=h[0];var e=h[1];var c=h[2];sps.detail(g,e,c,a)}else{base.popwinOpenText({title:"操作提示",msg:"尚未创建练习题，请稍后再试",hasConfirm:true})}},error:function(c,b,d){}})};sps.getRandomSeries=function(a){return 33)};sps.quesIndex=function(b,a){var c="0";var d=$.cookie("ex_range_"+b);if(undefined==d||"undefined"==d){if(a=="1"){c=sps.getRandomSeries(50)}$.cookie("ex_range_"+b,c,{path:"/sps/",expires:1})}else{c=d}if(typeof(c)=="string"){c=c.replace(/"/g,"")}jQuery.ajax({type:"post",url:sps.url.exercies.shiti+"?paperId="+b+"&series="+c,success:function(e){sps.quesIndexView(e);sps.initExercises(b,c,e)},error:function(g,f,h){}})};var answerData="";var numSecret;sps.answerQuesIndex=function(h,d){var l="";var i=base.getUrlParameters().series;var b=base.getCookie("loginUser").userAccount;var a=base.getUrlParameters().timeStr;var g=b+";"+a+";"+h+";"+i;var n=CryptoJS.enc.Utf8.parse(sps.url.captch.key);var f=CryptoJS.enc.Utf8.parse(sps.url.captch.iv);var m=CryptoJS.enc.Utf8.parse(g);var e=CryptoJS.AES.encrypt(m,n,{iv:f,mode:CryptoJS.mode.CBC,padding:CryptoJS.pad.Pkcs7});var c=CryptoJS.enc.Base64.stringify(e.ciphertext);jQuery.ajax({type:"post",async:false,url:sps.url.exercies.getAnswer,data:{secretKey:c,time:new Date()},success:function(p){if(p.code==200){var o=CryptoJS.AES.decrypt(p.data,n,{iv:f,mode:CryptoJS.mode.CBC,padding:CryptoJS.pad.Pkcs7});o=o.toString(CryptoJS.enc.Utf8);o=o.replace(/\u0000/g,"");let arr=o.split(";");answerData=arr[arr.length-1];numSecret=[arr[arr.length-3],arr[arr.length-2]]}},error:function(p,o,q){}});return l};sps.answerByQuestionId=function(a){var c="";var b=jQuery.parseJSON(answerData);$.each(b,function(d,e){e.questionId=Number(e.questionId)+Number(numSecret[1])-Number(numSecret[0]);if(a==e.questionId){c=e.answerNo;if(0==c){c="错"}else{if(1==c){c="对"}}return c}});return c};sps.getTiFromRedis=function(a,b){jQuery.ajax({type:"post",url:sps.url.exercies.tiInfo+"?questionId="+b,success:function(c){sps.getTiFromRedisView(a,b,c)},error:function(d,c,f){}})};sps.sort=function(d,c){if(/^\d/.test(d)^/^\D/.test(c)){return d>c?1:(d==c?0:-1)}return d>c?-1:(d==c?0:1)};sps.sortResult=function(d){if(d.length>1){var e="";for(var a=0;a<d.length;a++){e=e+d.substring(a,a+1)+","}e=e.substring(0,e.length-1);d=e.split(",").sort(sps.sort);var b="";for(var c=0;c<d.length;c++){b=b+d[c]}d=b}return d};sps.exerRes=function(d,c,b,g,e,a,f){if(d==1){b=b+'<li><input type="radio" name="rad_'+parseInt(c)+"\" value='"+f+"' /> "+g+"."+e+"</li>"}else{if(d==2){b=b+'<li><input type=checkbox name="allitem_'+parseInt(c)+"\" value='"+f+"' /> "+g+"."+e+"</li>"}else{if(d==3){b=b+'<li><input type="radio" name="rad_'+parseInt(c)+"\"value='"+f+"'/> "+g+"."+a+"</li>"}}}return b};sps.exerResChecked=function(d,f,c){if(d==1||d==3){var a="rad_"+c;jQuery('input[name="'+a+'"]').each(function(){var g=$(this).val();if(g==f){$(this).attr("checked",true)}})}else{if(d==2){f=f.split(";");for(var b=0;b<f.length;b++){var e=f[b];jQuery("input[name='allitem_"+c+"']").each(function(){var g=$(this).val();if(g==e){$(this).attr("checked",true)}})}}}};sps.clearCookByid=function(b){var a="user_"+b;base.removeCookie(a,{path:"/sps/"});delCookie(a)};function delCookie(b){var a=new Date();a.setTime(a.getTime()-10000);document.cookie=b+"=a; expires="+a.toGMTString()}sps.selecRight=function(f,e,c){if(1==c){if(f==e){return 1}}if(2==c&&f){f=sps.sortResult(f);var a=f.split(";");var d="";for(var b=0;b<a.length;b++){d=d+a[b]}if(d==e){return 1}}if(3==c){if("A"==f){f="对"}else{if("B"==f){f="错"}}if(f==e){return 1}}return 0};sps.answerIsTrue=function(a){var c=sps.getUserAnswer(a);var b=0;jQuery.ajax({type:"post",url:sps.url.exercies.tiInfo+"?questionId="+a,async:false,success:function(d){var g=jQuery.parseJSON(d);var h=JSON.parse(g);var e=h.type;var f=h.answer;if(1==e){if(c==f){b=1}}else{if(2==e){if(c){c=c.replace(",","");if(c==f){b=1}}}}}});return b};sps.answerIsTrue1=function(a){var f=sps.getUserAnswer(a);if(f==undefined){f=""}var c=sps.getquestionTypeById(a);var e=0;var d=sps.answerByQuestionId(a);if(1==c){if(f==d){e=1}}else{if(2==c){if(f){f=sps.sortResult(f);f=f.replace(/;/g,"");if(f==d){e=1}}}else{var b="";if(f=="B"){b="错"}if(f=="A"){b="对"}if(b==d){e=1}}}return e};var dataItemNo="";sps.getItemNo=function(b){var a=base.getUrlParameters().series;jQuery.ajax({type:"post",url:sps.url.exercies.shiti+"?paperId="+b+"&series="+a,async:false,success:function(c){dataItemNo=c},error:function(d,c,f){}})};sps.getItemNoById=function(d){var c="";if(""!=dataItemNo&&dataItemNo.indexOf("-1")!=1){var a=jQuery.parseJSON(dataItemNo);for(var b=0;b,a.length;b++){if(d==a[b]["questionId"]){c=a[b]["itemNo"];break}}}return c};sps.getPageData=function(idarray,page){idarray=idarray.substring(0,idarray.length-1);var array=idarray.split(",");var answer="";var parent=$("#result");parent.html("");var num=0;jQuery.ajax({type:"post",url:sps.url.exercies.tiInfo+"?questionId="+array,async:false,success:function(data){var errorIds=$.cookie("sps.error.ids");if(errorIds==undefined){errorIds=""}var da=data.replace(/(^\s*)|(\s*$)/g,"");if(da!="{}"){var questionsJson=eval("("+data+")");var qdata="["+questionsJson+"]";var dataObj=eval("("+qdata+")");$.each(dataObj,function(i,n){var number=((page-1)*10+i+1);var resultHtml="";var resultoption="";var imgUrl="/base/images/dui.png";var titype=n.type;var userSelectVal=sps.getUserAnswerResult(n.questionId);if(userSelectVal==undefined){userSelectVal=""}var answer=sps.answerByQuestionId(n.questionId);var answerErrorBak=answer;if(2==titype){resultHtml="<h3>"+number+"、（多选题）"+n.content+"</h3>"}if(1==titype){resultHtml="<h3>"+number+"、（单选题）"+n.content+"</h3>"}if(3==titype){resultHtml="<h3>"+number+"、（判断题）"+n.content+"</h3>"}var option=n.options.split(";");var itemNo=sps.getItemNoById(n.questionId);var itemNoErrorBak=itemNo;if(3==titype){option="对;错".split(";");itemNo="A,B"}var itemNoArry="";if(itemNo==""){itemNoArry=item}else{itemNoArry=itemNo.split(",")}var value="";var content="";for(var k=0;k<option.length;k++){value=itemNoArry[k];value=value.replace(/"/g,"");content=sps.getContent(value,option);resultoption=sps.exerRes(titype,i,resultoption,item[k],content,option[k],value)}$.cookie("ex_uid_"+i,userSelectVal+","+titype,{path:"/sps/",expires:1});num=num+1;userSelectVal=userSelectVal.replace(/;/g,"");userSelectVal=sps.getContentById1(userSelectVal,itemNo);userSelectVal=sps.sortResult(userSelectVal);if(3==titype){if("A"==userSelectVal){userSelectVal="对"}else{if("B"==userSelectVal){userSelectVal="错"}}if(answer=="A"){answer="对"}else{if(answer=="B"){answer="错"}}}else{answer=sps.getContentById1(answer,itemNo);answer=sps.sortResult(answer)}var ite=itemNo.replace(/"/g,"");if(answer==userSelectVal){parent.append("<li>"+resultHtml+"<ul class='options'>"+resultoption+"</ul><div class='clear correct'><strong>正确答案："+answer+"　　用户选择："+userSelectVal+"</strong></div><p class='jiexi' id='j"+n.questionId+"'><b>解析：<a href='javascript:sps.exeGetParse("+n.questionId+")'>展开解析↓</a><a href='###' class='fold'>收起解析↑</a></b><span id='p"+n.questionId+"'></span></p></li>")}else{var im="";if(errorIds.indexOf(n.questionId)==-1){im="<a id='d"+n.questionId+"' onclick='sps.importErrorEx("+n.questionId+","+n.type+',"'+itemNoErrorBak+'","'+answerErrorBak+'","d'+n.questionId+"\")'  href='javascript:void(0)'>导入到我的错题</a>"}else{im="<a id='d"+n.questionId+"' style='color:#FCFCFC' href='javascript:void(0)'>导入到我的错题</a>"}parent.append("<li>"+resultHtml+"<ul class='options'>"+resultoption+"</ul><div class='clear wrong'><strong>正确答案："+answer+"　　用户选择："+userSelectVal+"</strong>"+im+"</div><p class='jiexi' id='j"+n.questionId+"'><b>解析：<a href='javascript:sps.exeGetParse("+n.questionId+",this)'>展开解析↓</a><a href='###' class='fold'>收起解析↑</a></b><span id='p"+n.questionId+"'></span></p></li>")}})}}});for(var j=0;j<num;j++){var exinfo=$.cookie("ex_uid_"+j).split(",");sps.exerResChecked(exinfo[1],exinfo[0],j)}sps.jiexishow()};sps.getquestionTypeById=function(a){var e="";if(""!=dataItemNo&&dataItemNo.indexOf("-1")!=1){var d=base.nrMultiLineText2Array(dataItemNo);var b=jQuery.parseJSON(d);for(var c=0;c,b.length;c++){if(a==b[c]["questionId"]){e=b[c]["type"];break}}}return e};sps.getExercisesPoint=function(){var f=base.getCookie("loginUser",f);var g=f.domainCode;var b=false;if(sps.getData(g)=="false"){if("000"==g.substr(0,3)){grade=0}else{if("000"==g.substr(3,3)){grade=1}else{if("000"==g.substr(6,3)){grade=2}else{if("000"==g.substr(9,3)){grade=3}else{if("000"==g.substr(12,3)){grade=4}else{grade=5}}}}}var d="";for(var e=1;e<=grade;e++){var c=(grade-e)*3;d=sps.addStr(g.substr(0,c),15-c);var a=sps.getData(d);if(a=="true"){b=true;break}}if(!b){var g="000000000000000";sps.getData(g)}}};sps.getData=function(c){var a;var b=Date.parse(new Date());jQuery.ajax({type:"POST",async:false,url:sps.url.point.system_rule+"?targetDomainCode="+c+"&timestamp="+b,success:function(d){var e=base.nrMultiLineText2Array(d);if(e.length!=0){sps.pointView(e);a="true"}else{a="false"}},error:function(f,d,g){}});return a};sps.addStr=function(c,a){for(var b=0;b<(parseInt(a));b++){c+="0"}return c};sps.pointView=function(obj){var dataObj=eval(obj);var userAccount=base.getCookie("loginUser").userAccount;var userTotalScore=$("#totalScores").html();var minscore=0;var exepoint=-1;var exevalb=0;var todayepoint=0;$.each(dataObj,function(i,n){if(n=="exevald"){var epointv=dataObj[i+1];var arr=epointv.split(";");var count=arr.length;for(var i=0;i<count-1;i++){for(var j=i+1;j<count-1;j++){if(arr[i].split(",")[0]-arr[j].split(",")[0]>0){var temp=arr[i];arr[i]=arr[j];arr[j]=temp}}}var count=arr.length;minscore=arr[0].split(",")[0];for(var i=0;i<count-1;i++){var value1=arr[i].split(",")[0];var value2=arr[i].split(",")[1];if(i!=count-2){var value3=arr[i+1].split(",")[0];var value4=arr[i+1].split(",")[1];switch(true){case userTotalScore-value1<0:exepoint=0;break;case userTotalScore-value1>=0&&userTotalScore-value3<0:exepoint=value2;break}}else{switch(true){case userTotalScore-value1>=0:exepoint=value2;break}}if(exepoint!=-1){break}}}if(n=="exevalb"){exevalb=dataObj[i+1]}})};sps.exeGetParse=function(b,a){jQuery.ajax({type:"POST",url:sps.url.exercies.exeParse+"?questionId="+b+"&timestamp="+new Date(),success:function(c){var d=base.nrMultiLineText2Array(c);if(d==""){$("#j"+b).html("<b>解析：<i>暂无解析</i></b>")}else{$("#p"+b).html(d)}},error:function(d,c,f){}})};sps.importErrorEx=function(a,f,l,o,g){try{$("#"+g).removeAttr("onclick");$("#"+g).css("color","#FCFCFC");var h=$.cookie("sps.error.ids");if(h!=undefined&&h.indexOf(a)!=-1){return}if(h==undefined){h=""}var d=base.getCookie("loginUser");if(d==undefined){base.popwinOpenText({msg:"您的账号在其他地方登录，请您重新登录并及时修改密码",hasConfirm:true});$("#"+g).css("color","");$("#"+g).attr("onclick","sps.importErrorEx("+a+","+f+',"'+l+'","'+o+"\",'"+g+"');");return}var b=d.userAccount;var c=d.sid;var m=base.getUrlParameters().courseId;var p=sps.getUserAnswerResult(a);if(o=="对"){o="1"}else{if(o=="错"){o="0"}}var i={userAccount:b,sid:c,courseId:m,itemNo:l,answerNo:o,questionId:a,questionType:f,userselect:p,key:new Date()};$.ajax({type:"post",url:sps.url.errorExercies.importError,data:i,success:function(e){if(e.code==200){h+=a+",";$.cookie("sps.error.ids",h,{expires:1})}else{$("#"+g).css("color","");$("#"+g).attr("onclick","sps.importErrorEx("+a+","+f+',"'+l+'","'+o+"\",'"+g+"');")}base.popwinOpenText({msg:e.msg,title:"操作提示",hasConfirm:true})},error:function(s,q,u){$("#"+g).css("color","");$("#"+g).attr("onclick","sps.importErrorEx("+a+","+f+',"'+l+'","'+o+"\",'"+g+"');");base.popwinOpenText({msg:"请求失败，请重试！",hasConfirm:true})}})}catch(n){base.popwinOpenText({msg:"导入错题失败！",hasConfirm:true});$("#"+g).css("color","");$("#"+g).attr("onclick","sps.importErrorEx("+a+","+f+',"'+l+'","'+o+"\",'"+g+"');")}};sps.doGetExamDescription=function(){jQuery.ajax({type:"post",url:sps.url.exercies.doGetExamDescription,dataType:"text",async:false,success:function(a){$("#examDescription").text(a)},error:function(b,a,c){}})};sps.initExercises=function(d,c,g){var e=base.getUrlParameters().courseId;let t=sps.getSystemTimeExercises();let k=t+";"+e+"_"+d+"_"+c+";"+sps.url.captch.key;var i=CryptoJS.enc.Utf8.parse(sps.url.captch.key);var b=CryptoJS.enc.Utf8.parse(sps.url.captch.iv);var h=CryptoJS.enc.Utf8.parse(k);var a=CryptoJS.AES.encrypt(h,i,{iv:b,mode:CryptoJS.mode.CBC,padding:CryptoJS.pad.Pkcs7});var f=CryptoJS.enc.Base64.stringify(a.ciphertext);jQuery.ajax({type:"post",url:sps.url.courseware.initStudyExam,data:{userAccount:base.getCookie("loginUser").userAccount,ssid:base.getCookie("loginUser").sid,type:0,secondaryKey:encodeURI(f),time:t},success:function(n){if(n.code==200&&!!n.data&&!!n.data.secretKey){$("#sk").val(n.data.secretKey);var l=CryptoJS.AES.decrypt(n.data.secretKey,i,{iv:b,mode:CryptoJS.mode.CBC,padding:CryptoJS.pad.Pkcs7});l=l.toString(CryptoJS.enc.Utf8);l=l.replace(/\u0000/g,"");let arr=l.split(";");var m=sps.getExerciesTimecur();base.addCookie("captch_0_"+m+"_"+base.getCookie("loginUser").userAccount,null,{path:"/sps/",expires:-1});sps.geVodes(n.data.secretKey,d,c);sps.gePopIndex(g,arr[5],arr[3])}else{if(n.code==411){sps.popwinOpenTextForOutLine(false)}}}})};sps.getSystemTimeExercises=function(){var a;$.ajax({async:false,url:sps.url.courseware.getSystemTime,type:"post",success:function(b){if(!!b){a=b*1000}}});return a};function dec2bin(b){let arr=[];while(b>0){arr.push(b%2);b=Math.floor(b/2)}const a=[];while(arr.length>0){a.push(arr.pop())}return a.join("")}sps.gePopIndex=function(e,a,d){var c=jQuery.parseJSON(e);if(c==null){return}if(a>c.length){a=(c.length-2)/4;for(let j=1;j<c.length-1;j++){if(j%4==0){vIndex.push(c[j].questionId)}}}else{let qMap=new Map();let qArr=new Array();$.each(c,function(f,g){let queId=g.questionId;let bQueId=dec2bin(queId);let b5QueId=bQueId.substring(bQueId.length-5);let step1=bigDecimal.add(queId+"",bQueId);let step2=bigDecimal.add(step1+"",b5QueId);let step3=bigDecimal.multiply(step2+"",d+"");let key=bigDecimal.modulus(step3+"",c.length+"");if(!!qMap.get(key)){qArr=qMap.get(key)}else{qArr=new Array()}qArr.push(queId);qMap.set(key,qArr)});var b=Array.from(qMap);b.sort(function(g,f){let r=f[1].length-g[1].length;if(r==0){r=parseInt(g[0])-parseInt(f[0])}return r});$.each(b,function(f,g){let k=g[0];if(k=="0"||k==((c.length-1)+"")){return true}if(vIndex.indexOf((parseInt(k)+1)+"")>=0||vIndex.indexOf((parseInt(k)-1)+"")>=0){return true}vIndex.push(k);if(vIndex.length>=a){return false}})}};sps.geVodes=function(a,e,d){var f=base.getUrlParameters().courseId;let t=new Date().getTime();let k=t+";"+a+";"+sps.url.captch.key+";"+f+"_"+e+"_"+d;var i=CryptoJS.enc.Utf8.parse(sps.url.captch.key);var c=CryptoJS.enc.Utf8.parse(sps.url.captch.iv);var h=CryptoJS.enc.Utf8.parse(k);var b=CryptoJS.AES.encrypt(h,i,{iv:c,mode:CryptoJS.mode.CBC,padding:CryptoJS.pad.Pkcs7});var g=CryptoJS.enc.Base64.stringify(b.ciphertext);jQuery.ajax({type:"post",async:false,url:sps.url.courseware.getVodes,data:{type:0,secretKey:encodeURI(g),time:t},success:function(l){if(l.code==200&&!!l.data){let codes=CryptoJS.AES.decrypt(l.data,i,{iv:c,mode:CryptoJS.mode.CBC,padding:CryptoJS.pad.Pkcs7});codes=codes.toString(CryptoJS.enc.Utf8);codes=codes.replace(/\u0000/g,"");vCodes=codes.split(",")}}})};
